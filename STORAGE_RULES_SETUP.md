# ğŸ”’ Firebase Storage å®‰å…¨è§„åˆ™é…ç½®æŒ‡å—

## âŒ å½“å‰é—®é¢˜

é”™è¯¯ä¿¡æ¯ï¼š
```
storage/unauthorized
Firebase Storage: User does not have permission to access 'media/...'
```

**åŸå› **ï¼šFirebase Storage å®‰å…¨è§„åˆ™æœªé…ç½®æˆ–é…ç½®ä¸æ­£ç¡®ã€‚

## âœ… è§£å†³æ–¹æ¡ˆ

### æ–¹æ³• 1: ä¸´æ—¶æµ‹è¯•è§„åˆ™ï¼ˆå¿«é€Ÿæµ‹è¯•ï¼Œä¸æ¨èç”Ÿäº§ç¯å¢ƒï¼‰

å¦‚æœä½ åªæ˜¯æƒ³å¿«é€Ÿæµ‹è¯•ä¸Šä¼ åŠŸèƒ½ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹ä¸´æ—¶è§„åˆ™ï¼š

1. **è®¿é—® Firebase Console**
   - æ‰“å¼€ [Firebase Console](https://console.firebase.google.com/)
   - é€‰æ‹©ä½ çš„é¡¹ç›®ï¼š`siuroma-kids`

2. **è¿›å…¥ Storage è§„åˆ™é¡µé¢**
   - ç‚¹å‡»å·¦ä¾§èœå• **"Storage"**ï¼ˆå­˜å‚¨ç©ºé—´ï¼‰
   - ç‚¹å‡» **"è§„åˆ™"** æ ‡ç­¾é¡µ

3. **å¤åˆ¶å¹¶ç²˜è´´ä»¥ä¸‹æµ‹è¯•è§„åˆ™**ï¼š
   ```javascript
   rules_version = '2';
   service firebase.storage {
     match /b/{bucket}/o {
       match /{allPaths=**} {
         // âš ï¸ è­¦å‘Šï¼šè¿™æ˜¯æµ‹è¯•æ¨¡å¼ï¼Œå…è®¸æ‰€æœ‰äººè¯»å†™ï¼Œä¸å®‰å…¨ï¼
         // ä»…ç”¨äºå¼€å‘æµ‹è¯•ï¼Œç”Ÿäº§ç¯å¢ƒå¿…é¡»ä½¿ç”¨å®‰å…¨è§„åˆ™
         allow read, write: if request.resource.size < 100 * 1024 * 1024  // é™åˆ¶100MB
                            && request.resource.contentType.matches('image/.*|video/.*');
       }
     }
   }
   ```

4. **å‘å¸ƒè§„åˆ™**
   - ç‚¹å‡» **"å‘å¸ƒ"** æŒ‰é’®
   - ç­‰å¾…å‡ ç§’é’Ÿè®©è§„åˆ™ç”Ÿæ•ˆ

5. **æµ‹è¯•ä¸Šä¼ **
   - åˆ·æ–°æµè§ˆå™¨é¡µé¢
   - å°è¯•ä¸Šä¼ æ–‡ä»¶

âš ï¸ **é‡è¦**ï¼šè¿™ä¸ªè§„åˆ™å…è®¸ä»»ä½•äººä¸Šä¼ /ä¸‹è½½æ–‡ä»¶ï¼Œ**ä»…ç”¨äºæµ‹è¯•**ã€‚ç”Ÿäº§ç¯å¢ƒå¿…é¡»ä½¿ç”¨æ–¹æ³• 2ã€‚

---

### æ–¹æ³• 2: ç”Ÿäº§ç¯å¢ƒå®‰å…¨è§„åˆ™ï¼ˆæ¨èï¼‰

è¿™ä¸ªè§„åˆ™è¦æ±‚ç”¨æˆ·ç™»å½•ï¼Œå¹¶ä¸”åªèƒ½è®¿é—®è‡ªå·±çš„æ–‡ä»¶ã€‚

1. **è®¿é—® Firebase Console**
   - æ‰“å¼€ [Firebase Console](https://console.firebase.google.com/)
   - é€‰æ‹©ä½ çš„é¡¹ç›®ï¼š`siuroma-kids`

2. **è¿›å…¥ Storage è§„åˆ™é¡µé¢**
   - ç‚¹å‡»å·¦ä¾§èœå• **"Storage"**ï¼ˆå­˜å‚¨ç©ºé—´ï¼‰
   - ç‚¹å‡» **"è§„åˆ™"** æ ‡ç­¾é¡µ

3. **å¤åˆ¶å¹¶ç²˜è´´ä»¥ä¸‹å®‰å…¨è§„åˆ™**ï¼š
   ```javascript
   rules_version = '2';
   service firebase.storage {
     match /b/{bucket}/o {
       // ç”¨æˆ·åªèƒ½åœ¨è‡ªå·±çš„æ–‡ä»¶å¤¹ä¸‹ä¸Šä¼ æ–‡ä»¶
       match /media/{userId}/{allPaths=**} {
         // åªæœ‰ç™»å½•ç”¨æˆ·æ‰èƒ½ä¸Šä¼ 
         allow write: if request.auth != null 
                      && request.auth.uid == userId
                      && request.resource.size < 100 * 1024 * 1024  // é™åˆ¶100MB
                      && request.resource.contentType.matches('image/.*|video/.*');
         
         // åªæœ‰ç™»å½•ç”¨æˆ·æ‰èƒ½è¯»å–è‡ªå·±çš„æ–‡ä»¶
         allow read: if request.auth != null 
                     && request.auth.uid == userId;
         
         // åªæœ‰æ–‡ä»¶æ‰€æœ‰è€…æ‰èƒ½åˆ é™¤
         allow delete: if request.auth != null 
                       && request.auth.uid == userId;
       }
       
       // æ‹’ç»æ‰€æœ‰å…¶ä»–è®¿é—®
       match /{allPaths=**} {
         allow read, write: if false;
       }
     }
   }
   ```

4. **å‘å¸ƒè§„åˆ™**
   - ç‚¹å‡» **"å‘å¸ƒ"** æŒ‰é’®
   - ç­‰å¾…å‡ ç§’é’Ÿè®©è§„åˆ™ç”Ÿæ•ˆ

5. **é‡è¦ï¼šéœ€è¦ç”¨æˆ·ç™»å½•**
   - å¦‚æœä½¿ç”¨è¿™ä¸ªè§„åˆ™ï¼Œç”¨æˆ·å¿…é¡»é€šè¿‡ Firebase Auth ç™»å½•
   - å½“å‰åº”ç”¨ä½¿ç”¨ç¡¬ç¼–ç ç”¨æˆ·ï¼Œéœ€è¦ä¿®æ”¹ä»£ç ä»¥ä½¿ç”¨å®é™…ç™»å½•çš„ç”¨æˆ·

---

## ğŸ”§ è§„åˆ™è¯´æ˜

### æµ‹è¯•è§„åˆ™ï¼ˆæ–¹æ³• 1ï¼‰
- âœ… å…è®¸ä»»ä½•äººä¸Šä¼ /ä¸‹è½½
- âœ… é™åˆ¶æ–‡ä»¶å¤§å°ï¼ˆ100MBï¼‰
- âœ… é™åˆ¶æ–‡ä»¶ç±»å‹ï¼ˆå›¾ç‰‡å’Œè§†é¢‘ï¼‰
- âŒ **ä¸å®‰å…¨**ï¼šä»»ä½•äººéƒ½å¯ä»¥è®¿é—®æ‰€æœ‰æ–‡ä»¶

### ç”Ÿäº§è§„åˆ™ï¼ˆæ–¹æ³• 2ï¼‰
- âœ… åªæœ‰ç™»å½•ç”¨æˆ·æ‰èƒ½ä¸Šä¼ 
- âœ… ç”¨æˆ·åªèƒ½è®¿é—®è‡ªå·±çš„æ–‡ä»¶ï¼ˆ`userId` å¿…é¡»åŒ¹é…ï¼‰
- âœ… é™åˆ¶æ–‡ä»¶å¤§å°ï¼ˆ100MBï¼‰
- âœ… é™åˆ¶æ–‡ä»¶ç±»å‹ï¼ˆå›¾ç‰‡å’Œè§†é¢‘ï¼‰
- âœ… **å®‰å…¨**ï¼šç”¨æˆ·éš”ç¦»ï¼Œé˜²æ­¢æœªæˆæƒè®¿é—®

---

## ğŸ“‹ é…ç½®æ­¥éª¤æ€»ç»“

### å¿«é€Ÿæµ‹è¯•ï¼ˆ5åˆ†é’Ÿï¼‰

1. âœ… æ‰“å¼€ [Firebase Console](https://console.firebase.google.com/)
2. âœ… é€‰æ‹©é¡¹ç›®ï¼š`siuroma-kids`
3. âœ… ç‚¹å‡» **Storage** â†’ **è§„åˆ™**
4. âœ… å¤åˆ¶**æ–¹æ³• 1 çš„æµ‹è¯•è§„åˆ™**å¹¶ç²˜è´´
5. âœ… ç‚¹å‡» **"å‘å¸ƒ"**
6. âœ… åˆ·æ–°æµè§ˆå™¨ï¼Œæµ‹è¯•ä¸Šä¼ 

### ç”Ÿäº§ç¯å¢ƒï¼ˆéœ€è¦ä¿®æ”¹ä»£ç ï¼‰

1. âœ… é…ç½®**æ–¹æ³• 2 çš„å®‰å…¨è§„åˆ™**
2. âœ… ä¿®æ”¹ `MediaUpload.jsx` ä½¿ç”¨å®é™…ç™»å½•çš„ç”¨æˆ·ID
3. âœ… ç¡®ä¿ç”¨æˆ·å·²é€šè¿‡ Firebase Auth ç™»å½•

---

## ğŸ› å¸¸è§é—®é¢˜

### Q1: è§„åˆ™å‘å¸ƒåä»ç„¶æŠ¥é”™ï¼Ÿ

**A**: è§„åˆ™ç”Ÿæ•ˆéœ€è¦å‡ ç§’é’Ÿï¼Œå°è¯•ï¼š
- ç­‰å¾… 10-30 ç§’
- åˆ·æ–°æµè§ˆå™¨é¡µé¢
- æ¸…é™¤æµè§ˆå™¨ç¼“å­˜

### Q2: ä½¿ç”¨ç”Ÿäº§è§„åˆ™åä»ç„¶æŠ¥é”™ï¼Ÿ

**A**: æ£€æŸ¥ï¼š
1. ç”¨æˆ·æ˜¯å¦å·²ç™»å½•ï¼ˆ`request.auth != null`ï¼‰
2. `userId` æ˜¯å¦ä¸ç™»å½•ç”¨æˆ·çš„ `uid` åŒ¹é…
3. æ–‡ä»¶è·¯å¾„æ ¼å¼æ˜¯å¦æ­£ç¡®ï¼š`media/{userId}/images/...`

### Q3: å¦‚ä½•æŸ¥çœ‹å½“å‰è§„åˆ™ï¼Ÿ

**A**: 
- Firebase Console â†’ Storage â†’ è§„åˆ™
- å¯ä»¥çœ‹åˆ°å½“å‰é…ç½®çš„è§„åˆ™

### Q4: è§„åˆ™è¯­æ³•é”™è¯¯ï¼Ÿ

**A**: 
- æ£€æŸ¥æ˜¯å¦æœ‰æ‹¼å†™é”™è¯¯
- ç¡®ä¿æ‰€æœ‰æ‹¬å·åŒ¹é…
- ç¡®ä¿ä½¿ç”¨ `rules_version = '2';`

---

## ğŸ“ ä¸‹ä¸€æ­¥

é…ç½®è§„åˆ™åï¼Œå¦‚æœä½¿ç”¨**ç”Ÿäº§è§„åˆ™**ï¼Œè¿˜éœ€è¦ï¼š

1. **ä¿®æ”¹ `MediaUpload.jsx`** ä½¿ç”¨å®é™…ç™»å½•ç”¨æˆ·ï¼š
   ```javascript
   import { auth } from '../../lib/firebase';
   import { useAuthState } from 'react-firebase-hooks/auth';
   
   const [user] = useAuthState(auth);
   const userId = user?.uid;
   ```

2. **ä¿®æ”¹ `App.jsx`** å¯ç”¨å®é™…ç™»å½•ï¼ˆç§»é™¤ç¡¬ç¼–ç ç”¨æˆ·ï¼‰

---

## âœ… éªŒè¯é…ç½®

é…ç½®è§„åˆ™åï¼Œå°è¯•ä¸Šä¼ æ–‡ä»¶ï¼š

- âœ… **æˆåŠŸ**ï¼šæ–‡ä»¶ä¸Šä¼ æˆåŠŸï¼Œæ²¡æœ‰æƒé™é”™è¯¯
- âŒ **å¤±è´¥**ï¼šæ£€æŸ¥è§„åˆ™æ˜¯å¦æ­£ç¡®å‘å¸ƒï¼Œç­‰å¾…å‡ ç§’åé‡è¯•

